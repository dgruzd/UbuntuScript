document.write('<link rel="stylesheet" href="https://gist.github.com/stylesheets/gist/embed.css"/>')

document.write('<div id=\"gist-162525\" class=\"gist\">\n\n        <div class=\"gist-file\">\n          <div class=\"gist-data gist-syntax\">\n              <div class=\"gist-highlight\"><pre><div class=\'line\' id=\'LC1\'><span class=\"n\">set<\/span> <span class=\"ss\">:normal_symlinks<\/span><span class=\"p\">,<\/span> <span class=\"sx\">%w(<\/span><\/div><div class=\'line\' id=\'LC2\'><span class=\"sx\">  config/solr.yml<\/span><\/div><div class=\'line\' id=\'LC3\'><span class=\"sx\">  config/memcached.yml<\/span><\/div><div class=\'line\' id=\'LC4\'><span class=\"sx\">  config/database.yml<\/span><\/div><div class=\'line\' id=\'LC5\'><span class=\"sx\">  config/mongrel_cluster.yml<\/span><\/div><div class=\'line\' id=\'LC6\'><span class=\"sx\">)<\/span><\/div><div class=\'line\' id=\'LC7\'><br/><\/div><div class=\'line\' id=\'LC8\'><span class=\"n\">set<\/span> <span class=\"ss\">:weird_symlinks<\/span><span class=\"p\">,<\/span> <span class=\"p\">{<\/span><\/div><div class=\'line\' id=\'LC9\'>&nbsp;&nbsp;<span class=\"s1\">&#39;network_data_cache&#39;<\/span> <span class=\"o\">=&gt;<\/span> <span class=\"s1\">&#39;tmp/network_data_cache&#39;<\/span><span class=\"p\">,<\/span><\/div><div class=\'line\' id=\'LC10\'>&nbsp;&nbsp;<span class=\"s1\">&#39;impact_data_cache&#39;<\/span>  <span class=\"o\">=&gt;<\/span> <span class=\"s1\">&#39;tmp/impact_data_cache&#39;<\/span><span class=\"p\">,<\/span><\/div><div class=\'line\' id=\'LC11\'>&nbsp;&nbsp;<span class=\"s1\">&#39;podcast&#39;<\/span>            <span class=\"o\">=&gt;<\/span> <span class=\"s1\">&#39;public/gitsplosion&#39;<\/span><span class=\"p\">,<\/span><\/div><div class=\'line\' id=\'LC12\'>&nbsp;&nbsp;<span class=\"s1\">&#39;tarballs&#39;<\/span>           <span class=\"o\">=&gt;<\/span> <span class=\"s1\">&#39;public/tarballs&#39;<\/span><span class=\"p\">,<\/span><\/div><div class=\'line\' id=\'LC13\'>&nbsp;&nbsp;<span class=\"s1\">&#39;system&#39;<\/span>             <span class=\"o\">=&gt;<\/span> <span class=\"s1\">&#39;public/system&#39;<\/span><\/div><div class=\'line\' id=\'LC14\'><span class=\"p\">}<\/span><\/div><div class=\'line\' id=\'LC15\'><br/><\/div><div class=\'line\' id=\'LC16\'><span class=\"n\">namespace<\/span> <span class=\"ss\">:symlinks<\/span> <span class=\"k\">do<\/span><\/div><div class=\'line\' id=\'LC17\'>&nbsp;&nbsp;<span class=\"n\">desc<\/span> <span class=\"s2\">&quot;Make all the damn symlinks&quot;<\/span><\/div><div class=\'line\' id=\'LC18\'>&nbsp;&nbsp;<span class=\"n\">task<\/span> <span class=\"ss\">:make<\/span><span class=\"p\">,<\/span> <span class=\"ss\">:roles<\/span> <span class=\"o\">=&gt;<\/span> <span class=\"ss\">:app<\/span><span class=\"p\">,<\/span> <span class=\"ss\">:except<\/span> <span class=\"o\">=&gt;<\/span> <span class=\"p\">{<\/span> <span class=\"ss\">:no_release<\/span> <span class=\"o\">=&gt;<\/span> <span class=\"kp\">true<\/span> <span class=\"p\">}<\/span> <span class=\"k\">do<\/span><\/div><div class=\'line\' id=\'LC19\'>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"n\">commands<\/span> <span class=\"o\">=<\/span> <span class=\"n\">normal_symlinks<\/span><span class=\"o\">.<\/span><span class=\"n\">map<\/span> <span class=\"k\">do<\/span> <span class=\"o\">|<\/span><span class=\"n\">path<\/span><span class=\"o\">|<\/span><\/div><div class=\'line\' id=\'LC20\'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"s2\">&quot;rm -rf <\/span><span class=\"si\">#{<\/span><span class=\"n\">release_path<\/span><span class=\"si\">}<\/span><span class=\"s2\">/<\/span><span class=\"si\">#{<\/span><span class=\"n\">path<\/span><span class=\"si\">}<\/span><span class=\"s2\"> &amp;&amp; \\<\/span><\/div><div class=\'line\' id=\'LC21\'><span class=\"s2\">       ln -s <\/span><span class=\"si\">#{<\/span><span class=\"n\">shared_path<\/span><span class=\"si\">}<\/span><span class=\"s2\">/<\/span><span class=\"si\">#{<\/span><span class=\"n\">path<\/span><span class=\"si\">}<\/span><span class=\"s2\"> <\/span><span class=\"si\">#{<\/span><span class=\"n\">release_path<\/span><span class=\"si\">}<\/span><span class=\"s2\">/<\/span><span class=\"si\">#{<\/span><span class=\"n\">path<\/span><span class=\"si\">}<\/span><span class=\"s2\">&quot;<\/span><\/div><div class=\'line\' id=\'LC22\'>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"k\">end<\/span><\/div><div class=\'line\' id=\'LC23\'><br/><\/div><div class=\'line\' id=\'LC24\'>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"n\">commands<\/span> <span class=\"o\">+=<\/span> <span class=\"n\">weird_symlinks<\/span><span class=\"o\">.<\/span><span class=\"n\">map<\/span> <span class=\"k\">do<\/span> <span class=\"o\">|<\/span><span class=\"n\">from<\/span><span class=\"p\">,<\/span> <span class=\"n\">to<\/span><span class=\"o\">|<\/span><\/div><div class=\'line\' id=\'LC25\'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"s2\">&quot;rm -rf <\/span><span class=\"si\">#{<\/span><span class=\"n\">release_path<\/span><span class=\"si\">}<\/span><span class=\"s2\">/<\/span><span class=\"si\">#{<\/span><span class=\"n\">to<\/span><span class=\"si\">}<\/span><span class=\"s2\"> &amp;&amp; \\<\/span><\/div><div class=\'line\' id=\'LC26\'><span class=\"s2\">       ln -s <\/span><span class=\"si\">#{<\/span><span class=\"n\">shared_path<\/span><span class=\"si\">}<\/span><span class=\"s2\">/<\/span><span class=\"si\">#{<\/span><span class=\"n\">from<\/span><span class=\"si\">}<\/span><span class=\"s2\"> <\/span><span class=\"si\">#{<\/span><span class=\"n\">release_path<\/span><span class=\"si\">}<\/span><span class=\"s2\">/<\/span><span class=\"si\">#{<\/span><span class=\"n\">to<\/span><span class=\"si\">}<\/span><span class=\"s2\">&quot;<\/span><\/div><div class=\'line\' id=\'LC27\'>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"k\">end<\/span><\/div><div class=\'line\' id=\'LC28\'><br/><\/div><div class=\'line\' id=\'LC29\'>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"c1\"># needed for some of the symlinks<\/span><\/div><div class=\'line\' id=\'LC30\'>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"n\">run<\/span> <span class=\"s2\">&quot;mkdir -p <\/span><span class=\"si\">#{<\/span><span class=\"n\">current_path<\/span><span class=\"si\">}<\/span><span class=\"s2\">/tmp&quot;<\/span><\/div><div class=\'line\' id=\'LC31\'><br/><\/div><div class=\'line\' id=\'LC32\'>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"n\">run<\/span> <span class=\"o\">&lt;&lt;-<\/span><span class=\"no\">CMD<\/span><\/div><div class=\'line\' id=\'LC33\'><span class=\"sh\">      cd #{release_path} &amp;&amp;<\/span><\/div><div class=\'line\' id=\'LC34\'><span class=\"sh\">      #{commands.join(&quot; &amp;&amp; &quot;)}<\/span><\/div><div class=\'line\' id=\'LC35\'><span class=\"no\">    CMD<\/span><\/div><div class=\'line\' id=\'LC36\'>&nbsp;&nbsp;<span class=\"k\">end<\/span><\/div><div class=\'line\' id=\'LC37\'><span class=\"k\">end<\/span><\/div><div class=\'line\' id=\'LC38\'><br/><\/div><div class=\'line\' id=\'LC39\'><span class=\"n\">after<\/span> <span class=\"s2\">&quot;deploy:update_code&quot;<\/span><span class=\"p\">,<\/span> <span class=\"s2\">&quot;symlinks:make&quot;<\/span><\/div><\/pre><\/div>\n          <\/div>\n\n          <div class=\"gist-meta\">\n            <a href=\"https://gist.github.com/raw/162525/d0bc46228a470b00837e7a2144887e862751b1c1/symlinks.rb\" style=\"float:right;\">view raw<\/a>\n            <a href=\"https://gist.github.com/162525#file_symlinks.rb\" style=\"float:right;margin-right:10px;color:#666\">symlinks.rb<\/a>\n            <a href=\"https://gist.github.com/162525\">This Gist<\/a> brought to you by <a href=\"http://github.com\">GitHub<\/a>.\n          <\/div>\n        <\/div>\n<\/div>\n')
